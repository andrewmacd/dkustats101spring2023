---
title: "Lecture 2.1 - Association and correlation"
subtitle: "DKU Stats 101 Spring 2023"
author: "Professor MacDonald"
date: "3/30/2023"
output: 
  learnr::tutorial:
    toc_depth: 2
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)

library(tidyverse)
library(gridExtra)
library(knitr)
library(learnr)

theme_set(theme_classic())

kc.houses <- read.csv("www/king.county.sales.recent.csv")
classroster <- read.csv("www/classroster.csv", fileEncoding="UTF-8-BOM")

kc.houses <- kc.houses %>% 
  mutate(view = ifelse(rowSums(across(starts_with("view"))) > 0, 1, 0)) %>% 
  mutate(wfnt = factor(wfnt, levels=c(0, 1), labels=c("Not on waterfront", "On waterfront"))) %>% 
  mutate(view = factor(view, levels=c(0, 1), labels=c("No view", "View")))

```

# Association and correlation

## Exercise 1

In your groups, try to think of two variables that, in the real world, that might have this correlation for each of the following correlations. Try to think of a few examples for each correlation.

-   0.95
-   0.75
-   0.5
-   0.25
-   0.0
-   -0.25
-   -0.5
-   -0.75
-   -0.95

Pick a few of these and draw by hand what you expect these graphs to look like.

```{r picker1, exercise=TRUE}
sample(classroster$name, 1)
```

## Exercise 2

![Seattle](www/seattle.jpg){width="800"}

### Exercise details

In your groups, develop some expectations about some of the variables in the `kc.houses` dataset might be related.

Variables:

```{r datasetdetails, exercise=TRUE}
kc.houses.short <- kc.houses %>% 
  select(c(sale_price, year_built, sqft, sqft_lot, beds, bath_full, view, stories))

kable(names(kc.houses.short), col.names=c("Variables"))
```

What to do with your partner:

1.  Write down some questions (at least 3) we think we might be able to answer with this dataset
2.  Choose some variables that you think might be able to answer these questions
3.  Write down what you expect the relationship to be between these two variables based on any prior knowledge
4.  Decide which variable is the response variable and which is the predictor variable

```{r picker2, exercise=TRUE}
sample(classroster$name, 1)
```

## Viewing an example relationship

-   First, what is our expectation about the relationship between bedrooms and bathrooms?
-   Direction?
-   Form?
-   Strength?
-   Outliers?

```{r picker3, exercise=TRUE}
sample(classroster$name, 1)
```

## Bedrooms and bathrooms - direction

A scatterplot is the easiest way to check for direction. In this case, the direction is obvious

```{r bbdirection, exercise=TRUE}
# should we jitter this?
ggplot(kc.houses, aes(x=beds, y=bath_full)) + 
  geom_point() +
  labs(x="Bedrooms", y="Bathrooms")
```

## Bedrooms and bathrooms - form

```{r bbform, exercise=TRUE}
ggplot(kc.houses, aes(x=beds, y=bath_full)) + 
  geom_point(position="jitter") +
  geom_smooth(method="loess", se=FALSE) +
  labs(x="Bedrooms", y="Bathrooms")
```

## Bedrooms and bathrooms - strength

```{r bbstrength, exercise=TRUE}
ggplot(kc.houses, aes(x=beds, y=bath_full)) + 
  geom_point(position="jitter") +
  geom_smooth(method="loess", se=FALSE) +
  labs(x="Bedrooms", y="Bathrooms")
```

```{r picker4, exercise=TRUE}
sample(classroster$name, 1)
```

### Correlation as a measure of strength

```{r bbcorr, exercise=TRUE}
kable(kc.houses %>% 
        summarize(cor(beds, bath_full, use="complete.obs")), col.names="Correlation")
```

This correlation is a little weaker than perhaps what we expected

-   In general, mechanically generated processes with little noise can have very high correlations
-   Most correlations of social or real world processes rarely have above moderate correlation due to noise

## Bedrooms and bathrooms - outlier

Again, we do not have a rule for selecting outliers other than to observe them on the scatterplot. In this case, there is one very obvious value far from other values

```{r bboutlierplot, exercise=TRUE}
ggplot(kc.houses, aes(x=beds, y=bath_full)) + 
  geom_point(position="jitter") +
  geom_smooth(method="loess", se=FALSE)  +
  geom_text(data=kc.houses %>% filter(bath_full > 7), # Filter data first
    aes(label=bath_full), vjust=0.5, color="red") +
  labs(x="Bedrooms", y="Bathrooms")
```

To investigate if this outlier matters, we can check some other values of the observation.

```{r bboutlier, exercise=TRUE}
kable(
  kc.houses %>%
    filter(bath_full>7) %>%
    select(c(sale_price, sqft, sqft_lot, beds, stories)))
```

What kind of outlier do you think this is? Why?

```{r picker5, exercise=TRUE}
sample(classroster$name, 1)
```

### Outlier - actual observation

```{r bboutlier1, exercise=TRUE}
kable(
  kc.houses %>%
    filter(bath_full>7) %>%
    select(c(latitude, longitude)))
```

![Location](www/location.png){width="800"}

### Data with no outlier

```{r bbnooutlier, exercise=TRUE}
#should we jitter this?
kc.houses %>%
  filter(bath_full<=7) %>%  
  ggplot(aes(x=beds, y=bath_full)) + 
    geom_point(position="jitter") +
    geom_smooth(method="loess", se=FALSE) +
    labs(x="Bedrooms", y="Bathrooms")
```

### Describing the association

1.  Direction - positive
2.  Form - linear
3.  Strength - moderate/strong
4.  Outliers - one possible

Outlier:

```{r bboutlier2, exercise=TRUE}
kable(
  kc.houses %>%
    filter(bath_full>7) %>%
    select(c("price", "sqft_living", "sqft_lot", "lat", "long")))
```

## Does b/b relationship match expectations?

-   Seems to, more or less, the more bedrooms, the more bathrooms, so the relationship is positive
-   The relationship is fairly linear, indicating a strong relationship
-   Relationship is moderate
-   Only one outlier, and hard to say if it is a mistake

However....

-   What are some possible lurking variables that influence the relationship of bedrooms and bathrooms?

```{r picker6, exercise=TRUE}
sample(classroster$name, 1)
```

## Relationship reexpressed?

One final issue to consider is if this relationship should be reexpressed - made more linear.

```{r bbreexpress, exercise=TRUE}
kc.houses %>%
  mutate(log.bedrooms = log(beds),
         log.bathrooms = log(bath_full)) %>%
  ggplot(aes(x=log.bathrooms, y=log.bedrooms)) + 
    geom_point() +
    geom_smooth(method="lm", se=FALSE) +
    labs(x="Log Bedrooms", y="Log Bathrooms")
```

-   Doesn't seem so clear
